<?php 
require_once "../../config/settings.inc.php";
require_once "../../include/myview.php";
$t = new MyView();
require_once "../../include/forms.php"; 
$t->title = "Climatology by Year";
require_once "../../include/adodb-time.inc.php";

$year = isset($_GET["year"]) ? intval($_GET["year"]) : date("Y") - 1;
$prod = isset($_GET["prod"]) ? intval($_GET["prod"]) : 1;

$products = Array(
 1 => Array("name" => "Total Precipitation", 
            "tpl" => "/archive/data/%Y/summary/total_precip.png"),
 2 => Array("name" => "Days with Precipitation", 
            "tpl" => "/archive/data/%Y/summary/precip_days.png"),
 20 => Array("name" => "Average High Temperature", 
            "tpl" => "/archive/data/%Y/summary/avg_high.png"),
 21 => Array("name" => "Average Low Temperature", 
            "tpl" => "/archive/data/%Y/summary/avg_low.png"),
 22 => Array("name" => "Average Temperature", 
            "tpl" => "/archive/data/%Y/summary/avg_temp.png"),

);

$ts = adodb_mktime(1,1,1,1,1,$year);
$imgurl = strftime($products[$prod]["tpl"],$ts);

$a = "";
foreach($products as $key => $ar){
	$a .= sprintf("<option value=\"%s\" %s>%s", $key,
			($prod == $key) ? "SELECTED": "", $ar["name"]);
}
$ys = yearSelect(1893, $year);

$t->content = <<<EOF
<h3>Yearly Summaries</h3>
<p>Please select from the following menu to view an analysis map of your 
choice.  Some of these maps are generated by a griding of once daily NWS COOP 
observations.  Data quality is always an issue, so please exercise caution
when using these plots.</p>

<div style="border: 1px solid #000; padding: 5px;">
<form name="selector" action="year.phtml">
<strong>Year:</strong> {$ys} 
<strong>Product:</strong> <select name="prod">{$a}</select>
<input type="submit" value="Request Plot">
<br />
<img src="{$imgurl}" alt="plot" />
</form>
</div>
EOF;
$t->render('single.phtml');
?>